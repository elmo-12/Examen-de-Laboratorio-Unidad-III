graph LR
    subgraph "Usuario"
        U[ğŸ‘¤ Usuario Web<br/>Navegador]
    end

    subgraph "Frontend Layer - Puerto 8501"
        ST[ğŸ–¥ï¸ Streamlit App<br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Dashboard<br/>ğŸ“¦ Equipos<br/>ğŸ¢ Proveedores<br/>ğŸ”§ Mantenimiento<br/>ğŸ“ˆ Reportes]
    end

    subgraph "API Gateway - Puerto 8000"
        direction TB
        APIGW[ğŸŒ FastAPI Gateway<br/>â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ AutenticaciÃ³n<br/>âœ“ Rate Limiting<br/>âœ“ Load Balancing<br/>âœ“ Health Checks]
    end

    subgraph "Business Logic - Microservicios"
        direction TB
        
        subgraph "GestiÃ³n de Activos"
            MS1[ğŸ“¦ Equipos<br/>â”â”â”â”â”â”â”<br/>Inventario<br/>Ubicaciones<br/>Movimientos<br/>CategorÃ­as]
            MS2[ğŸ¢ Proveedores<br/>â”â”â”â”â”â”â”<br/>CatÃ¡logo<br/>Contratos<br/>Compras]
        end
        
        subgraph "Operaciones"
            MS3[ğŸ”§ Mantenimiento<br/>â”â”â”â”â”â”â”<br/>Preventivo<br/>Correctivo<br/>Calendario<br/>Costos]
        end
        
        subgraph "AnÃ¡lisis y Reportes"
            MS4[ğŸ“Š Reportes<br/>â”â”â”â”â”â”â”<br/>Dashboard<br/>EstadÃ­sticas<br/>PDF/Excel<br/>GrÃ¡ficos]
        end
        
        subgraph "AutomatizaciÃ³n"
            MS5[ğŸ¤– Agentes<br/>â”â”â”â”â”â”â”<br/>Recordatorios<br/>Alertas<br/>Notificaciones<br/>AnÃ¡lisis]
        end
    end

    subgraph "Data Layer"
        direction TB
        PG[(ğŸ—„ï¸ PostgreSQL<br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“‹ 11 Tablas<br/>ğŸ”— Relaciones<br/>ğŸ“Š Vistas<br/>âš¡ Ãndices)]
        
        V1[/ğŸ’¾ Volumen DB<br/>Persistencia/]
        V2[/ğŸ“ Volumen Reportes<br/>Archivos/]
    end

    subgraph "Agentes Inteligentes - Tareas Automatizadas"
        direction LR
        A1[â° Check Maintenance<br/>Verifica mantenimientos<br/>programados]
        A2[ğŸ“… Check Obsolescence<br/>Detecta equipos<br/>obsoletos]
        A3[âš ï¸ Check Warranties<br/>Alerta garantÃ­as<br/>por vencer]
        A4[ğŸ’° Analyze Costs<br/>Analiza costos<br/>de mantenimiento]
    end

    %% Flujo principal
    U -->|HTTPS| ST
    ST -->|REST API| APIGW
    
    APIGW -->|Route /api/equipos| MS1
    APIGW -->|Route /api/proveedores| MS2
    APIGW -->|Route /api/mantenimientos| MS3
    APIGW -->|Route /api/reportes| MS4
    APIGW -->|Route /api/agents| MS5
    
    MS1 -->|SQL Queries| PG
    MS2 -->|SQL Queries| PG
    MS3 -->|SQL Queries| PG
    MS4 -->|SQL Queries| PG
    MS5 -->|SQL Queries| PG
    
    PG -.->|Persiste| V1
    MS4 -.->|Guarda archivos| V2
    
    MS5 -->|Ejecuta| A1
    MS5 -->|Ejecuta| A2
    MS5 -->|Ejecuta| A3
    MS5 -->|Ejecuta| A4
    
    A1 -.->|Crea notificaciones| PG
    A2 -.->|Crea notificaciones| PG
    A3 -.->|Crea notificaciones| PG
    A4 -.->|Crea notificaciones| PG

    %% Estilos
    classDef userStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef frontendStyle fill:#667eea,stroke:#333,stroke-width:3px,color:#fff
    classDef gatewayStyle fill:#764ba2,stroke:#333,stroke-width:3px,color:#fff
    classDef serviceStyle fill:#48bb78,stroke:#333,stroke-width:2px,color:#fff
    classDef dbStyle fill:#f56565,stroke:#333,stroke-width:3px,color:#fff
    classDef storageStyle fill:#ed8936,stroke:#333,stroke-width:2px,color:#fff
    classDef agentStyle fill:#ffd700,stroke:#333,stroke-width:2px,color:#000

    class U userStyle
    class ST frontendStyle
    class APIGW gatewayStyle
    class MS1,MS2,MS3,MS4,MS5 serviceStyle
    class PG dbStyle
    class V1,V2 storageStyle
    class A1,A2,A3,A4 agentStyle